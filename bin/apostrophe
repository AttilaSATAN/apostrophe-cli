#!/usr/bin/env node

require('shelljs/global');
require('colors');
var config = require('../config');

checkDependencies(config.SHELL_DEPENDS);

processArgs(process.argv.slice(2));

function processArgs(args) {
	var commandInput = args[0];

	try {
		var command = require("../lib/commands/" + commandInput);
		if(command(args.slice(1))) {
			log(commandInput + " finished successfully");
		} else {
			err(commandInput + " failed");
		}
	} catch(e) {
		// Fallback, alias for apostrophe: commands
		if(require("../lib/commands/apostrophe")(args)) {
			log("apostrophe:" + commandInput + " finished successfully");
		} else {
			err("Not a valid command");
		}
	}
}

function checkDependencies(dependencies) {
	for (var i in dependencies) {
		var dep = dependencies[i];
		if (!which(dep)) {
		  err(dep + ' not found');
		  err('Please install missing dependency')
		  exit(1);
		}
	}
}

function log(msg) {
	console.log(msg);
}

function err(msg) {
	log(msg.red);
}