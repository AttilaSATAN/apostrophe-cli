#!/usr/bin/env node

require('shelljs/global');
var config = require('../config');
require('colors');
var prefix = ' Apostrophe '.bgWhite.red;

checkDependencies(config.SHELL_DEPENDS);

processArgs(process.argv.slice(2));

function processArgs(args) {
	var commandInput = args[0];
	var styledCommand = ' '.bgRed + commandInput.bgRed.white + ' '.bgRed;
	try {
		var command = require("../lib/commands/" + commandInput);

		if(command(args.slice(1))) {

			log(prefix + styledCommand +  " Finished successfully.".green);
		} else {
			err(prefix + styledCommand + " Failed".red);
		}
	} catch(e) {
		// Fallback, alias for apostrophe: commands
		if(require("../lib/commands/apostrophe")(args)) {
			log(prefix +  styledCommand + " Finished successfully.".green);
		} else {
			err(prefix + " Not a valid command".red);
		}
	}
}

function checkDependencies(dependencies) {
	for (var i in dependencies) {
		var dep = dependencies[i];
		if (!which(dep)) {
		  err(dep + ' not found');
		  err('Please install missing dependency')
		  exit(1);
		}
	}
}

function log(msg) {
	console.log(msg);
}

function err(msg) {
	log(msg.red);
}
